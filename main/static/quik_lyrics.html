<html>
  <head>
    <title>QuikLyrics | Predictive, No Ads Lyrics Search</title>
    <script src="/static/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="/static/bower_components/paper-autocomplete/paper-autocomplete.html">
    <link rel="import" href="/static/bower_components/paper-card/paper-card.html">
    <link rel="import" href="/static/bower_components/iron-ajax/iron-ajax.html" />
    <link rel="import" href="/static/bower_components/iron-list/iron-list.html" />
    <link rel="import" href="/static/bower_components/paper-collapse-item/paper-collapse-item.html" />
    <link rel="import" href="/static/bower_components/pushstate-anchor/pushstate-anchor.html">
    <link rel="import" href="/static/bower_components/app-route/app-route.html">
    <link rel="import" href="/static/bower_components/app-route/app-location.html">
    <link rel="import" href="/static/bower_components/paper-item/paper-item.html">    
    <link rel="import"  href="/static/bower_components/paper-header-panel/paper-header-panel.html" />
    <link rel="import" href="/static/bower_components/paper-toolbar/paper-toolbar.html" />
    <link rel="import" href="/static/bower_components/paper-progress/paper-progress.html" />
    <link rel="import" href="/static/bower_components/paper-radio-group/paper-radio-group.html" />
    <link rel="import" href="/static/bower_components/paper-styles/color.html" />
    <link rel="import" href="/static/bower_components/paper-styles/paper-styles-classes.html" />
    <link rel="import" href="/static/bower_components/paper-styles/typography.html" />
    <link rel="import" href="/static/bower_components/paper-radio-button/paper-radio-button.html" />
    <link rel="import" href="/static/bower_components/iron-flex-layout/iron-flex-layout.html" />
    <link rel="import" href="/static/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
    <link rel="import" href="/static/bower_components/iron-icons/iron-icons.html">
    <style is="custom-style" include="iron-flex iron-flex-alignment"></style>
    <link rel="import" href="/static/components/denim.html" />
    <link rel="import" href="/static/css/style.html" />
  </head>
  <dom-module id="quik-lyrics">
  <template>
  <app-location route="{{route}}" use-hash-as-path></app-location>
  <app-route
      route="{{route}}"
      active="{{active}}"
      pattern="/:lyricsOrChords/:lyrics"
      data="{{routeData}}"
      tail="{{routeDataTail}}">
  </app-route>
    <iron-ajax
      auto
      url="/suggest"
      params="[[_updateParams(suggestQuery)]]"
      handle-as="json"
      last-response="{{suggestions}}">
    ></iron-ajax>
    <iron-ajax
      loading="{{loading}}"
      auto
      url="/[[routeData.lyricsOrChords]]"
      params="[[_updateParams(routeData.lyrics)]]"
      handle-as="json"
      last-response="{{lyrics}}">
    ></iron-ajax>
    <paper-header-panel main>
    <paper-toolbar>
      <h1>QuikLyrics</h1>
      <paper-radio-group selected="{{routeData.lyricsOrChords}}">
      <paper-radio-button name="lyrics">Lyrics</paper-radio-button>
      <paper-radio-button name="chords">Chords</paper-radio-button>
    </paper-radio-group>
    </paper-toolbar>
    <template is="dom-if" if="[[loading]]">
    <paper-progress indeterminate class="green" disabled="[[!loading]]"></paper-progress>
    </template>
    <div class="quiklyrics content">
    <paper-autocomplete required="true" auto-validate="false" autofocus="autofocus" label="Lyrics or song sample" min-length="2" source="[[_processSuggestions(suggestions)]]" text="{{suggestQuery}}" on-autocomplete-selected="_updateLyricsQuery"></paper-autocomplete>
    <paper-card heading="[[lyrics.Lyrics.Title]]">
    <div class="card-content">
    <template is="dom-if" if="[[!loading]]">
    <paper-collapse-item header="Alternatives" icon="icons:list">
    <iron-list items="[[lyrics.Alternatives]]">
      <template>
      <paper-item>
        <a href="[[item.Url]]">[[item.Title]]</a>
      </paper-item>
      </template>
    </iron-list>
    </paper-collapse-item>
    </template>
    <div id="actual-lyrics">
      [[lyrics.Lyrics.Lyrics]]    
    </div>
    </div>
    </paper-card>
    </div>
    </paper-header-panel>
  </template>
  <script>
  Polymer({
    is: 'quik-lyrics',
    properties: {
      "lyrics": Object,
    },
    attached: function() {
        if (this.route.path === '') {
          this.set('route.path', '/lyrics/mattress that you stole');
        }
    },
    _updateParams: function(s) {
      return {lyrics: s};
    },
    _processSuggestions: function(s) {
      return s.suggestions.map(function(ss){
        return {value: ss , text: ss};
      });
    },
    _updateLyricsQuery: function(event) {
      var lyricsSearch = event.detail.text;
      this.set('routeData.lyrics', lyricsSearch);
    },
  });
  </script>
  </dom-module>
  <body class="layout vertical">
  <quik-lyrics></quik-lyrics>
  </body>
</html>
    
