<html>
  <head>
    <title>QuikLyrics | Predictive, No Ads Lyrics Search</title>
    <script src="/static/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="/static/bower_components/polymer/polymer.html">
    <link rel="import" href="/static/components/paper-autocomplete/paper-autocomplete.html">
    <link rel="import" href="/static/bower_components/paper-card/paper-card.html">
    <link rel="import" href="/static/bower_components/iron-ajax/iron-ajax.html" />
    <link rel="import" href="/static/bower_components/iron-list/iron-list.html" />
    <link rel="import" href="/static/bower_components/paper-collapse-item/paper-collapse-item.html" />
    <link rel="import" href="/static/bower_components/pushstate-anchor/pushstate-anchor.html">
    <link rel="import" href="/static/bower_components/app-route/app-route.html">
    <link rel="import" href="/static/bower_components/app-route/app-location.html">
    <link rel="import" href="/static/bower_components/paper-item/paper-item.html">    
    <link rel="import"  href="/static/bower_components/paper-header-panel/paper-header-panel.html" />
    <link rel="import" href="/static/bower_components/paper-toolbar/paper-toolbar.html" />
    <link rel="import" href="/static/bower_components/paper-progress/paper-progress.html" />
    <link rel="import" href="/static/bower_components/paper-radio-group/paper-radio-group.html" />
    <link rel="import" href="/static/bower_components/paper-styles/color.html" />
    <link rel="import" href="/static/bower_components/paper-styles/paper-styles-classes.html" />
    <link rel="import" href="/static/bower_components/paper-styles/typography.html" />
    <link rel="import" href="/static/bower_components/paper-radio-button/paper-radio-button.html" />
    <link rel="import" href="/static/bower_components/iron-flex-layout/iron-flex-layout.html" />
    <link rel="import" href="/static/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
    <link rel="import" href="/static/bower_components/iron-icons/iron-icons.html">
    <link rel="import" href="/static/components/denim.html" />
    <link rel="import" href="/static/css/style.html" />
  </head>
  <body class="layout vertical">
  <dom-module id="html-echo">
  <style>
    :host {
      display: block;
    }
  </style>
  <template>
  </template>
  <script>
    Polymer({
      is: 'html-echo',
      properties: {
        html: {
          type: String,
          observer: '_htmlChanged'
        }
      },
      _htmlChanged: function (neo) {
        // WARNING: potential XSS vulnerability if `html` comes from an untrusted source
        this.innerHTML = neo;
      }
    });
</script>
</dom-module>
  <dom-module id="quik-lyrics">
  <template>
  <app-location route="{{route}}" use-hash-as-path></app-location>
  <app-route
      route="{{route}}"
      active="{{active}}"
      pattern="/:lyricsOrChords/:lyrics"
      data="{{routeData}}"
      tail="{{routeDataTail}}">
  </app-route>
    <iron-ajax
      auto
      url="/suggest"
      params="[[_updateParams(suggestQuery)]]"
      handle-as="json"
      last-response="{{suggestions}}">
    ></iron-ajax>
    <iron-ajax
      loading="{{loading}}"
      auto
      url="/[[routeData.lyricsOrChords]]"
      params="[[_updateParams(routeData.lyrics)]]"
      handle-as="json"
      last-response="{{lyrics}}"></iron-ajax>
    <iron-ajax
      id="alternatives-ajax"
      auto
      verbose="true"
      loading="{{urlLoading}}"
      url="/url"
      params="[[_alternativeParams(selectedAlternative)]]"
      last-response="{{lyrics.Lyrics}}"
      handle-as="json"></iron-ajax>
    <paper-header-panel main>
    <paper-toolbar>
      <a class="nostyle" href="/quik#/lyrics/you stick around and it may show"><h1>QuikLyrics</h1></a>
      <paper-radio-group selected="{{routeData.lyricsOrChords}}">
      <paper-radio-button name="lyrics">Lyrics</paper-radio-button>
      <paper-radio-button name="chords">Chords</paper-radio-button>
    </paper-radio-group>
    </paper-toolbar>
    <template is="dom-if" if="[[loading]]">
    <paper-progress class="green" indeterminate disabled="[[_progressDisabled(loading, urlLoading)]]"></paper-progress>
    </template>
    <div class="quiklyrics content">
    <paper-autocomplete autofocus="autofocus" label="Lyrics or song sample" min-length="2" source="[[_processSuggestions(suggestions)]]" text="{{suggestQuery}}" on-autocomplete-selected="_updateLyricsQuery"></paper-autocomplete>
    <paper-card heading="[[lyrics.Lyrics.Title]]">
    <div class="card-content">
    <template is="dom-if" if="[[!loading]]">
    <paper-collapse-item opened="{{openedCollapse}}" header="Alternatives" icon="icons:list">
    <iron-list as="item" items="[[lyrics.Alternatives]]" selection-enabled selected-item="{{selectedAlternative}}">
      <template>
        <paper-item>
        <div>[[item.Title]]</div>
        </paper-item>
      </template>
    </iron-list>
    </paper-collapse-item>
    </template>
    <div id="actual-lyrics">
    <template is="dom-if" if="[[_isLyrics(routeData.lyricsOrChords, loading)]]">
      [[lyrics.Lyrics.Lyrics]]
    </template>
    <template is="dom-if" if="[[_isChords(routeData.lyricsOrChords, loading)]]">
      <tt>
        <html-echo html="[[lyrics.Lyrics.Lyrics]]"></html-echo>
      </tt>
    </template>
    </div>
    </div>
    </paper-card>
    </div>
    </paper-header-panel>
  </template>
  <script>
  Polymer({
    is: 'quik-lyrics',
    properties: {
      "lyrics": Object,
    },
    attached: function() {
        if (this.route.path === '') {
          this.set('route.path', '/lyrics/mattress that you stole');
        }
    },
    _isChords: function(lyricsOrChords, loading) {
      return 'chords' == lyricsOrChords && !loading;
    },
    _isLyrics: function(lyricsOrChords, loading) {
      return 'lyrics' == lyricsOrChords && !loading;
    },
    _updateParams: function(s) {
      return {lyrics: s, lyricsOrChords: this.routeData.lyricsOrChords};
    },
    _processSuggestions: function(s) {
      return s.suggestions.map(function(ss){
        return {value: ss , text: ss};
      });
    },
    _updateLyricsQuery: function(event) {
      var lyricsSearch = event.detail.text;
      this.set('routeData.lyrics', lyricsSearch);
    },
    _alternativeParams: function(item) {
      this.openedCollapse = false;
      if (item == null) {
        var oldParams = this.$['alternatives-ajax'].params;
        if (oldParams == undefined) {
          return {};
        }
        return oldParams;
      }
      return {
        url: item.Url,
        lyricsOrChords: this.routeData.lyricsOrChords
      };
    },
    _progressDisabled: function(loading, urlLoading) {
      return !this.loading && !this.urlLoading;
    }
  });
  </script>
  </dom-module>
  <quik-lyrics></quik-lyrics>
  </body>
</html>
    
